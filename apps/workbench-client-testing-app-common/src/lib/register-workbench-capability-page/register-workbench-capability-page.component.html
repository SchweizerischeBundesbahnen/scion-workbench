<form autocomplete="off" [formGroup]="form">
  <section>
    <sci-form-field label="Type">
      <select [formControl]="form.controls.type" class="e2e-type">
        <option [value]="WorkbenchCapabilities.Perspective">PERSPECTIVE</option>
        <option [value]="WorkbenchCapabilities.Part">PART</option>
        <option [value]="WorkbenchCapabilities.View">VIEW</option>
        <option [value]="WorkbenchCapabilities.Dialog">DIALOG</option>
        <option [value]="WorkbenchCapabilities.MessageBox">MESSAGEBOX</option>
        <option [value]="WorkbenchCapabilities.Popup">POPUP</option>
        <option [value]="WorkbenchCapabilities.Notification">NOTIFICATION</option>
      </select>
    </sci-form-field>

    <sci-form-field label="Qualifier">
      <sci-key-value-field [keyValueFormArray]="form.controls.qualifier" [addable]="true" [removable]="true" class="e2e-qualifier"/>
    </sci-form-field>

    <sci-form-field label="Params">
      <app-capability-params [formControl]="form.controls.params" [showTransientParams]="form.controls.type.value === 'view'"/>
    </sci-form-field>

    <sci-form-field label="Private">
      <sci-checkbox [formControl]="form.controls.private" class="e2e-private"/>
    </sci-form-field>
  </section>

  @switch (form.controls.type.value) {
    @case (WorkbenchCapabilities.Perspective) {
      <app-perspective-capability-properties [formControl]="form.controls.perspectiveProperties"/>
    }
    @case (WorkbenchCapabilities.Part) {
      <app-part-capability-properties [formControl]="form.controls.partProperties"/>
    }
    @case (WorkbenchCapabilities.View) {
      <app-view-capability-properties [formControl]="form.controls.viewProperties"/>
    }
    @case (WorkbenchCapabilities.Popup) {
      <app-popup-capability-properties [formControl]="form.controls.popupProperties"/>
    }
    @case (WorkbenchCapabilities.Dialog) {
      <app-dialog-capability-properties [formControl]="form.controls.dialogProperties"/>
    }
    @case (WorkbenchCapabilities.MessageBox) {
      <app-message-box-capability-properties [formControl]="form.controls.messageBoxProperties"/>
    }
    @case (WorkbenchCapabilities.Notification) {
      <app-notification-capability-properties [formControl]="form.controls.notificationProperties"/>
    }
  }

  <button (click)="onRegister()" class="e2e-register" [disabled]="form.invalid" sci-primary>Register</button>

  @if (capability) {
    <output class="register-response">
      Capability ID: {{capability.metadata!.id}}
    </output>

    <output class="register-response e2e-register-response">
      <sci-viewport>
        <div class="e2e-capability">{{capability | json}}</div>
      </sci-viewport>
    </output>
  }

  @if (registerError) {
    <output class="register-error e2e-register-error">
      {{registerError}}
    </output>
  }
</form>
